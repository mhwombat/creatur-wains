------------------------------------------------------------------------
-- |
-- Module      :  ALife.Creatur.Wain.UtilQC
-- Copyright   :  (c) Amy de Buitl√©ir 2013
-- License     :  BSD-style
-- Maintainer  :  amy@nualeargais.ie
-- Stability   :  experimental
-- Portability :  portable
--
-- QuickCheck tests.
--
------------------------------------------------------------------------
{-# OPTIONS_GHC -fno-warn-orphans #-}
module ALife.Creatur.Wain.UtilQC
  (
    test,
    equiv
  ) where

import ALife.Creatur.Wain.Util
import ALife.Creatur.Wain.TestUtils (arb8BitDouble,
  prop_serialize_round_trippable, prop_genetic_round_trippable,
  prop_diploid_identity)
import Control.Applicative ((<$>))
import Data.Datamining.Pattern (difference)
import Test.Framework (Test, testGroup)
import Test.Framework.Providers.QuickCheck2 (testProperty)
import Test.QuickCheck

instance Arbitrary UIDouble where
  arbitrary = doubleToUI <$> arb8BitDouble unitInterval

equiv :: UIDouble -> UIDouble -> Bool
equiv x y = abs (uiToDouble x - uiToDouble y) < 1e-12

equiv2 :: UIVector -> UIVector -> Bool
equiv2 x y = difference x y < 1e-12

sizedArbUIVector :: Int -> Gen UIVector
sizedArbUIVector n = fmap UIVector $ vectorOf n arbitrary

instance Arbitrary UIVector where
  arbitrary = sized sizedArbUIVector

prop_UIVector_difference_in_range :: UIVector -> UIVector -> Property
prop_UIVector_difference_in_range x y = property $ 0 <= diff && diff <= 1
  where diff = difference x y

test :: Test
test = testGroup "ALife.Creatur.Wain.UtilQC"
  [
    testProperty "prop_serialize_round_trippable - UIDouble"
      (prop_serialize_round_trippable :: UIDouble -> Property),
    testProperty "prop_genetic_round_trippable - UIDouble"
      (prop_genetic_round_trippable equiv :: UIDouble -> Property),
    testProperty "prop_diploid_identity - UIDouble"
      (prop_diploid_identity (==) :: UIDouble -> Property),
    testProperty "prop_serialize_round_trippable - UIVector"
      (prop_serialize_round_trippable :: UIVector -> Property),
    testProperty "prop_genetic_round_trippable - UIVector"
      (prop_genetic_round_trippable equiv2 :: UIVector -> Property),
    testProperty "prop_diploid_identity - UIVector"
      (prop_diploid_identity (==) :: UIVector -> Property),
    testProperty "prop_UIVector_difference_in_range"
      prop_UIVector_difference_in_range
  ]
